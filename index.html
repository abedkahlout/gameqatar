<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Ù…Ù‡Ù…Ø© Ø§Ù„Ø¹Ø§Ù„ÙÙ…Ø© | Ø§Ù„Ù…Ø³Ø§Ø± Ø§Ù„ÙˆØ·Ù†ÙŠ 2030</title>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;500;600;700;800;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        /* ============ Ø§Ù„Ù…ØªØºÙŠØ±Ø§Øª ÙˆØ§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© ============ */
        :root {
            --primary: #006C35;
            --primary-light: #10b981;
            --primary-dark: #004d26;
            --accent: #fbbf24;
            --secondary: #1e3a8a;
            --danger: #ef4444;
            --bg-white: #ffffff;
            --text-dark: #1e293b;
            --text-muted: #64748b;
            --border: #e2e8f0;
            --shadow-sm: 0 1px 2px 0 rgb(0 0 0 / 0.05);
            --shadow-md: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
            --shadow-lg: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1);
            --radius-md: 12px;
            --radius-lg: 20px;
            --radius-xl: 28px;
        }

        * { 
            margin: 0; 
            padding: 0; 
            box-sizing: border-box; 
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        body {
            font-family: 'Cairo', sans-serif;
            background: radial-gradient(circle at top right, #f8fafc, #e0f2fe);
            color: var(--text-dark);
            height: 100vh; 
            overflow: hidden;
            user-select: none; 
            -webkit-tap-highlight-color: transparent;
            line-height: 1.6;
        }

        /* ============ Ø§Ù„Ø­Ø§ÙˆÙŠØ© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© ============ */
        .container { 
            width: 100%; 
            height: 100vh; 
            display: flex; 
            flex-direction: column; 
            position: relative;
        }

        /* ============ Ø§Ù„Ø´Ø±ÙŠØ· Ø§Ù„Ø¹Ù„ÙˆÙŠ ============ */
        .top-bar {
            background: rgba(255, 255, 255, 0.8);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border-bottom: 1px solid rgba(226, 232, 240, 0.8);
            padding: 12px 24px; 
            display: flex; 
            justify-content: space-between; 
            align-items: center;
            box-shadow: var(--shadow-sm); 
            z-index: 100;
        }

        .badge {
            background: var(--bg-white); 
            padding: 8px 16px; 
            border-radius: 100px; 
            font-weight: 700;
            color: var(--primary); 
            border: 1px solid var(--border); 
            font-size: 0.9rem;
            display: flex; 
            align-items: center; 
            gap: 8px; 
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: var(--shadow-sm);
        }

        .badge:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
            border-color: var(--primary-light);
        }

        .points-badge { 
            background: #fffbeb; 
            color: #b45309; 
            border-color: #fde68a; 
        }

        .badge-exit { 
            background: #fef2f2; 
            color: var(--danger); 
            border-color: #fecaca; 
        }

        .badge-exit:hover {
            background: var(--danger);
            color: white;
            border-color: var(--danger);
        }

        /* ============ Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ù„Ø¹Ø¨Ø© ============ */
        .game-area {
            flex: 1; 
            display: flex; 
            flex-direction: column; 
            align-items: center;
            justify-content: center; 
            padding: 20px; 
            overflow-y: auto; 
            position: relative;
            background: url('data:image/svg+xml,<svg width="20" height="20" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><g fill="%239C92AC" fill-opacity="0.05" fill-rule="evenodd"><circle cx="3" cy="3" r="3"/><circle cx="13" cy="13" r="3"/></g></svg>');
        }

        /* ============ Ø§Ù„Ø®Ø±ÙŠØ·Ø© ============ */
        .map-container {
            position: relative; 
            width: 100%; 
            max-width: 600px; 
            aspect-ratio: 1;
            background: var(--bg-white); 
            border-radius: var(--radius-xl);
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.15); 
            border: 8px solid white; 
            overflow: hidden;
            transition: transform 0.5s ease;
        }

        .map-container:hover {
            transform: scale(1.01);
        }

        .map-image { 
            width: 100%; 
            height: 100%; 
            object-fit: cover; 
            display: block; 
            filter: saturate(1.2) brightness(1.05);
        }

        /* Ø­Ø±ÙƒØ© Ø§Ù„Ù…Ø±ÙƒØ¨Ø© */
        .vehicle {
            position: absolute;
            width: 50px; 
            height: 50px;
            font-size: 2.5rem; 
            color: var(--accent);
            filter: drop-shadow(0 4px 6px rgba(0,0,0,0.3));
            z-index: 50;
            transition: all 1.5s cubic-bezier(0.68, -0.55, 0.265, 1.55);
            pointer-events: none;
            display: flex; 
            justify-content: center; 
            align-items: center;
        }

        /* ============ Ø§Ù„Ø£Ø²Ø±Ø§Ø± (Ø§Ù„Ù…Ù†Ø§Ø·Ù‚) ============ */
        .region-btn {
            position: absolute; 
            width: 50px; 
            height: 50px; 
            border-radius: 50%;
            cursor: pointer; 
            border: 4px solid white; 
            display: flex; 
            align-items: center;
            justify-content: center; 
            font-size: 1.3rem;
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275); 
            box-shadow: var(--shadow-lg); 
            z-index: 10;
        }

        .region-btn:hover {
            transform: scale(1.2) rotate(5deg);
            z-index: 20;
        }

        .region-btn.locked { 
            background: #cbd5e1; 
            border-color: #f1f5f9; 
            color: #94a3b8; 
            cursor: not-allowed;
        }

        .region-btn.active {
            background: white; 
            color: var(--primary); 
            border-color: var(--accent);
            animation: pulse-ring 2s infinite; 
            z-index: 15;
        }

        @keyframes pulse-ring {
            0% { box-shadow: 0 0 0 0 rgba(251, 191, 36, 0.7); }
            70% { box-shadow: 0 0 0 15px rgba(251, 191, 36, 0); }
            100% { box-shadow: 0 0 0 0 rgba(251, 191, 36, 0); }
        }

        .region-btn.completed {
            background: var(--primary); 
            border-color: white;
            color: white !important;
        }

        .region-btn.completed::after {
            content: '\f058'; 
            font-family: "Font Awesome 6 Free"; 
            font-weight: 900;
            position: absolute; 
            top: -10px; 
            right: -10px; 
            width: 24px; 
            height: 24px;
            background: var(--primary-light); 
            color: white; 
            border: 2px solid white;
            border-radius: 50%; 
            font-size: 12px; 
            display: flex; 
            justify-content: center; 
            align-items: center;
            box-shadow: var(--shadow-md); 
            z-index: 20;
        }

        .region-label {
            position: absolute; 
            top: 120%; 
            left: 50%; 
            transform: translateX(-50%);
            background: rgba(30, 41, 59, 0.9); 
            padding: 4px 12px; 
            border-radius: 8px;
            font-size: 0.85rem; 
            font-weight: 700; 
            white-space: nowrap;
            box-shadow: var(--shadow-md); 
            color: white;
            pointer-events: none; 
            opacity: 0; 
            transition: all 0.3s; 
            z-index: 11;
        }

        .region-btn:hover .region-label, 
        .region-btn.active .region-label, 
        .region-btn.completed .region-label { 
            opacity: 1; 
            top: 110%;
        }

        /* ============ Ø´Ø±ÙŠØ· Ø§Ù„ØªÙ‚Ø¯Ù… ============ */
        .progress-container {
            width: 100%; 
            max-width: 600px; 
            margin-top: 30px; 
            background: rgba(255, 255, 255, 0.9);
            padding: 20px; 
            border-radius: var(--radius-lg); 
            box-shadow: var(--shadow-lg); 
            border: 1px solid rgba(255, 255, 255, 0.5);
            backdrop-filter: blur(8px);
        }

        .progress-bar { 
            width: 100%; 
            height: 12px; 
            background: #f1f5f9; 
            border-radius: 100px; 
            overflow: hidden; 
            margin-top: 10px;
            border: 1px solid #e2e8f0;
        }

        .progress-fill { 
            height: 100%; 
            background: linear-gradient(90deg, var(--primary), var(--primary-light)); 
            border-radius: 100px; 
            transition: width 0.8s cubic-bezier(0.34, 1.56, 0.64, 1); 
        }

        .progress-label { 
            display: flex; 
            justify-content: space-between; 
            font-size: 1rem; 
            font-weight: 800; 
            color: var(--text-dark); 
        }

        /* ============ Ø§Ù„Ù†ÙˆØ§ÙØ° Ø§Ù„Ù…Ù†Ø¨Ø«Ù‚Ø© ============ */
        .overlay {
            display: none; 
            position: fixed; 
            top: 0; 
            left: 0; 
            width: 100%; 
            height: 100%;
            background: rgba(15, 23, 42, 0.6); 
            z-index: 1000; 
            align-items: center; 
            justify-content: center;
            backdrop-filter: blur(8px); 
            padding: 20px; 
            animation: fadeIn 0.4s ease-out;
        }

        .overlay.active { display: flex; }

        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        .popup-box {
            background: var(--bg-white); 
            padding: 40px; 
            border-radius: var(--radius-xl);
            width: 100%; 
            max-width: 480px; 
            text-align: center;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5); 
            animation: slideUp 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            max-height: 90vh; 
            overflow-y: auto;
            position: relative;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        @keyframes slideUp { 
            from { transform: translateY(30px); opacity: 0; } 
            to { transform: translateY(0); opacity: 1; } 
        }

        /* Ø¹Ù†Ø§ØµØ± Ø§Ù„Ù…ØªØ¬Ø± */
        .store-grid {
            display: grid; 
            grid-template-columns: repeat(2, 1fr); 
            gap: 20px; 
            margin-top: 25px;
        }

        .store-item {
            border: 2px solid var(--border); 
            border-radius: var(--radius-lg); 
            padding: 20px;
            display: flex; 
            flex-direction: column; 
            align-items: center; 
            gap: 12px;
            transition: all 0.3s; 
            position: relative;
            background: #f8fafc;
        }

        .store-item:hover {
            border-color: var(--primary-light);
            transform: translateY(-5px);
            background: white;
        }

        .store-item.unlocked { 
            border-color: var(--primary-light); 
            background: #f0fdf4; 
        }

        .store-item.selected { 
            border-color: var(--accent); 
            background: #fffbeb;
            box-shadow: 0 0 0 2px var(--accent); 
        }

        .avatar-icon { 
            font-size: 3rem; 
            color: var(--primary); 
            filter: drop-shadow(0 4px 6px rgba(0,0,0,0.1));
        }

        .price-tag { 
            background: var(--accent); 
            color: #92400e;
            padding: 4px 12px; 
            border-radius: 100px; 
            font-size: 0.85rem; 
            font-weight: 800; 
        }

        .btn-buy { 
            background: var(--primary); 
            color: white; 
            border: none; 
            padding: 8px 20px; 
            border-radius: 10px; 
            cursor: pointer; 
            font-size: 0.9rem; 
            font-weight: 700;
            transition: all 0.2s;
        }

        .btn-buy:hover:not(:disabled) {
            background: var(--primary-dark);
            transform: scale(1.05);
        }

        .btn-buy:disabled { 
            background: #cbd5e1; 
            cursor: not-allowed; 
        }

        /* Ø¨Ø§Ù‚ÙŠ Ø§Ù„Ø¹Ù†Ø§ØµØ± */
        .input-field { 
            width: 100%; 
            padding: 16px; 
            border: 2px solid var(--border); 
            border-radius: var(--radius-md); 
            font-family: 'Cairo'; 
            text-align: center; 
            margin-bottom: 20px; 
            outline: none; 
            font-size: 1.1rem;
            transition: border-color 0.3s;
        }

        .input-field:focus {
            border-color: var(--primary);
        }

        .btn { 
            width: 100%; 
            padding: 16px; 
            border: none; 
            border-radius: var(--radius-md); 
            font-family: 'Cairo'; 
            font-weight: 800; 
            cursor: pointer; 
            transition: all 0.3s; 
            display: flex; 
            align-items: center; 
            justify-content: center; 
            gap: 10px; 
            font-size: 1.1rem; 
        }

        .btn-primary { 
            background: linear-gradient(135deg, var(--primary), var(--primary-dark)); 
            color: white; 
            box-shadow: 0 10px 20px -5px rgba(0, 108, 53, 0.4); 
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 15px 25px -5px rgba(0, 108, 53, 0.5);
        }

        .btn-option { 
            background: white; 
            border: 2px solid #f1f5f9; 
            margin: 12px 0; 
            color: var(--text-dark); 
            text-align: right; 
            justify-content: flex-start;
            padding: 18px 24px;
            font-weight: 600;
        }

        .btn-option:hover {
            background: #f8fafc;
            border-color: var(--border);
            transform: translateX(-5px);
        }

        .btn-option.correct { 
            background: #dcfce7; 
            border-color: #22c55e; 
            color: #166534; 
        }

        .btn-option.wrong { 
            background: #fee2e2; 
            border-color: #ef4444; 
            color: #991b1b; 
        }

        /* ØªÙ†Ø³ÙŠÙ‚Ø§Øª Ø§Ù„Ø·Ø¨Ø§Ø¹Ø© (Ø§Ù„Ø´Ù‡Ø§Ø¯Ø©) */
        .certificate-print { display: none; }

        @media print {
            @page { size: landscape; margin: 0; }
            body * { visibility: hidden; }
            .certificate-print, .certificate-print * { visibility: visible; }
            .certificate-print {
                display: flex; 
                position: fixed; 
                left: 0; 
                top: 0; 
                width: 100%; 
                height: 100%;
                background: white; 
                padding: 60px; 
                text-align: center; 
                border: 20px solid var(--primary);
                flex-direction: column; 
                justify-content: center; 
                align-items: center;
                background-image: url('https://www.transparenttextures.com/patterns/arabesque.png');
            }
            .cert-header { font-size: 4rem; color: var(--primary); margin-bottom: 30px; font-weight: 900; }
            .cert-body { font-size: 2rem; margin: 40px 0; line-height: 1.8; color: #334155; }
            .cert-name { 
                font-size: 3.5rem; 
                color: var(--primary-dark); 
                font-weight: 900; 
                display: block;
                margin: 20px 0;
                border-bottom: 4px double var(--accent);
                padding-bottom: 10px;
            }
            .cert-date { margin-top: 60px; font-size: 1.5rem; color: #64748b; }
            .cert-logo { font-size: 7rem; color: var(--accent); margin-bottom: 30px; }
        }

        /* ØªÙ†Ø³ÙŠÙ‚Ø§Øª Ø´Ø§Ø´Ø© Ø§Ù„Ù‡Ø§ØªÙ */
        @media (max-width: 600px) {
            .top-bar { padding: 10px 15px; }
            .badge { padding: 6px 12px; font-size: 0.8rem; }
            .map-container { border-width: 4px; border-radius: var(--radius-lg); }
            .region-btn { width: 42px; height: 42px; font-size: 1.1rem; border-width: 3px; }
            .popup-box { padding: 25px 20px; }
            .store-grid { grid-template-columns: 1fr; }
            .btn-option { padding: 14px 18px; font-size: 1rem; }
        }
    </style>
</head>
<body>

<div class="certificate-print" id="print-area">
    <div class="cert-logo"><i class="fas fa-award"></i></div>
    <h1 class="cert-header">Ø´Ù‡Ø§Ø¯Ø© Ø¥Ù†Ø¬Ø§Ø²</h1>
    <div class="cert-body">
        ØªØ´Ù‡Ø¯ Ù…Ù†ØµØ© Ø§Ù„Ù…Ø³Ø§Ø± Ø§Ù„ÙˆØ·Ù†ÙŠ 2030 Ø¨Ø£Ù† Ø§Ù„Ø¹Ø§Ù„Ù…Ø©<br>
        <span class="cert-name" id="cert-name-display">Ø§Ø³Ù… Ø§Ù„Ø·Ø§Ù„Ø¨Ø©</span><br>
        Ù‚Ø¯ Ø£ØªÙ…Øª Ø§Ù„Ø±Ø­Ù„Ø© Ø§Ù„Ø¹Ù„Ù…ÙŠØ© Ù„Ø§Ø³ØªÙƒØ´Ø§Ù Ù…Ù†Ø§Ø·Ù‚ Ø§Ù„Ù…Ù…Ù„ÙƒØ© Ø¨Ù†Ø¬Ø§Ø­ ÙˆØªÙ…ÙŠØ².
    </div>
    <div class="cert-date">
        ØªØ§Ø±ÙŠØ® Ø§Ù„Ù…Ù†Ø­: <span id="cert-date-display"></span><br>
    </div>
</div>

<div class="container">
    <div class="top-bar">
        <div style="display: flex; gap: 8px; align-items: center;">
            <div class="badge" onclick="openStore()">
                <i id="current-avatar-icon" class="fas fa-user-astronaut"></i> 
                <span id="name-display">...</span>
            </div>
            <div class="badge points-badge">
                <i class="fas fa-coins"></i> <span id="score-display">0</span>
            </div>
        </div>
        <div class="badge badge-exit" onclick="resetGame()"><i class="fas fa-sign-out-alt"></i> Ø®Ø±ÙˆØ¬</div>
    </div>

    <div class="game-area" id="game-ui" style="display: none;">
        <div class="map-container" id="map-container">
            <img src="map3.png" alt="Ø®Ø±ÙŠØ·Ø© Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠØ©" class="map-image" style="opacity: 0.6;">
            
            <div id="vehicle" class="vehicle" style="top: 38%; left: 50%;">
                <i class="fas fa-car-side"></i>
            </div>

            <div class="region-btn" id="btn-0" onclick="handleClick(0)"></div>
            <div class="region-btn" id="btn-1" onclick="handleClick(1)"></div>
            <div class="region-btn" id="btn-2" onclick="handleClick(2)"></div>
            <div class="region-btn" id="btn-3" onclick="handleClick(3)"></div>
            <div class="region-btn" id="btn-4" onclick="handleClick(4)"></div>
        </div>

        <div class="progress-container">
            <div class="progress-label">
                <span id="progress-text">0/5</span>
                <span>Ø§Ù„ØªÙ‚Ø¯Ù…</span>
            </div>
            <div class="progress-bar">
                <div class="progress-fill" id="progress-fill" style="width: 0%;"></div>
            </div>
        </div>
        <div style="margin-top:10px; color: var(--primary); font-weight:bold;" id="msg-box"></div>
    </div>
</div>

<div id="login-overlay" class="overlay active">
    <div class="popup-box">
        <h2 style="color: var(--primary); margin-bottom: 20px;">Ù…Ù‡Ù…Ø© Ø§Ù„Ø¹Ø§Ù„ÙÙ…Ø© 2030 ğŸ‡¸ğŸ‡¦</h2>
        <p style="margin-bottom: 20px; color: #555;">Ø£Ù‡Ù„Ø§Ù‹ Ø¨ÙƒÙ ÙÙŠ Ø±Ø­Ù„Ø© Ø§Ø³ØªÙƒØ´Ø§Ù Ù…Ù†Ø§Ø·Ù‚ Ø§Ù„Ù…Ù…Ù„ÙƒØ©.<br>Ø§ÙƒØªØ¨ÙŠ Ø§Ø³Ù…ÙƒÙ Ù„ØªØ¨Ø¯Ø£ Ø§Ù„Ø±Ø­Ù„Ø©.</p>
        <input type="text" id="username" class="input-field" placeholder="Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ø«Ù„Ø§Ø«ÙŠ">
        <button class="btn btn-primary" onclick="startGame()">Ø§Ø¨Ø¯Ø£ Ø§Ù„Ø±Ø­Ù„Ø© ğŸš€</button>
    </div>
</div>

<div id="quiz-overlay" class="overlay">
    <div class="popup-box">
        <div style="display:flex; justify-content:space-between; margin-bottom:10px;">
            <span style="color:red;" id="hearts">â¤â¤â¤</span>
            <span style="font-weight:bold;" id="quiz-title"></span>
        </div>
        <div style="background:#eee; height:5px; border-radius:5px; margin-bottom:15px;">
            <div id="quiz-progress-fill" style="background:var(--primary); height:100%; width:0%; transition:0.3s;"></div>
        </div>
        <h3 id="quiz-question" style="margin-bottom:20px;"></h3>
        <div id="quiz-options"></div>
        <div id="quiz-feedback" style="margin-top:10px; font-weight:bold;"></div>
    </div>
</div>

<div id="info-overlay" class="overlay">
    <div class="popup-box">
        <i class="fas fa-trophy" style="font-size: 4rem; color: var(--accent); margin-bottom: 15px;"></i>
        <h2 id="info-title" style="color:var(--primary);"></h2>
        <p id="info-desc" style="background:#f0fdf4; padding:15px; border-radius:10px; margin:15px 0; line-height:1.6;"></p>
        <button class="btn btn-primary" onclick="closeInfoAndProceed()">Ù…ØªØ§Ø¨Ø¹Ø© Ø§Ù„Ø±Ø­Ù„Ø© ğŸš—</button>
    </div>
</div>

<div id="win-overlay" class="overlay">
    <div class="popup-box">
        <i class="fas fa-crown" style="font-size: 4rem; color: gold; margin-bottom: 15px; animation: pulse 1s infinite;"></i>
        <h2 style="color: var(--primary);">Ø£Ù„Ù Ù…Ø¨Ø±ÙˆÙƒ!</h2>
        <p style="margin: 10px 0;">Ù„Ù‚Ø¯ Ø£ØªÙ…Ù…ØªÙ Ø§Ù„Ù…Ø³Ø§Ø± Ø§Ù„ÙˆØ·Ù†ÙŠ Ø¨Ù†Ø¬Ø§Ø­ Ø¨Ø§Ù‡Ø±.</p>
        <h3 id="winner-name" style="color: var(--secondary); margin: 15px 0;"></h3>
        
        <button class="btn btn-primary" onclick="printCertificate()" style="margin-bottom: 10px; background: var(--secondary);">
            <i class="fas fa-print"></i> Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„Ø´Ù‡Ø§Ø¯Ø©
        </button>
        <button class="btn" style="background: #f1f5f9; color: #333;" onclick="resetGame()">
            <i class="fas fa-redo"></i> Ø¨Ø¯Ø§ÙŠØ© Ø¬Ø¯ÙŠØ¯Ø©
        </button>
    </div>
</div>

<div id="store-overlay" class="overlay">
    <div class="popup-box">
        <h3>Ù…ØªØ¬Ø± Ø§Ù„Ù…ÙƒØ§ÙØ¢Øª ğŸ</h3>
        <p>Ø±ØµÙŠØ¯Ùƒ: <span id="store-score" style="color: var(--accent); font-weight:bold;">0</span> ğŸª™</p>
        
        <div class="store-grid" id="store-grid">
            </div>
        
        <button class="btn" style="margin-top: 20px; background: #ddd;" onclick="document.getElementById('store-overlay').classList.remove('active')">Ø¥ØºÙ„Ø§Ù‚</button>
    </div>
</div>

<audio id="snd-correct" src="https://assets.mixkit.co/active_storage/sfx/2000/2000-preview.mp3"></audio>
<audio id="snd-wrong" src="https://assets.mixkit.co/active_storage/sfx/2003/2003-preview.mp3"></audio>
<audio id="snd-win" src="https://assets.mixkit.co/active_storage/sfx/2019/2019-preview.mp3"></audio>

<script>
    /* ============ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ============ */
    const regions = [
        { 
            name: "Ø§Ù„Ù…Ù†Ø·Ù‚Ø© Ø§Ù„ÙˆØ³Ø·Ù‰", 
            pos: {top: '38%', left: '50%'}, 
            desc: "Ù‚Ù„Ø¨ Ø§Ù„Ù…Ù…Ù„ÙƒØ© Ø§Ù„Ù†Ø§Ø¨Ø¶ØŒ ØªÙ†Ø·Ù„Ù‚ Ù…Ù†Ù‡Ø§ Ø§Ù„Ù‚ÙŠØ§Ø¯Ø© ÙˆØªØ²Ø¯Ù‡Ø± ÙÙŠÙ‡Ø§ Ø§Ù„ØªÙ†Ù…ÙŠØ©.",
            qs: [
                {q: "Ø¹Ø§ØµÙ…Ø© Ø§Ù„Ø¯ÙˆÙ„Ø© Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠØ© Ø§Ù„Ø£ÙˆÙ„Ù‰ Ù‡ÙŠØŸ", opts: ["Ø§Ù„Ø¯Ø±Ø¹ÙŠØ©", "Ø§Ù„Ø±ÙŠØ§Ø¶", "Ù…ÙƒØ©"], a: 0},
                {q: "ØªÙ‚Ø¹ Ù…Ø¯ÙŠÙ†Ø© Ø§Ù„Ø±ÙŠØ§Ø¶ ÙÙŠ Ø§Ù„Ù…Ù†Ø·Ù‚Ø©ØŸ", opts: ["Ø§Ù„Ø´Ø±Ù‚ÙŠØ©", "Ø§Ù„ÙˆØ³Ø·Ù‰", "Ø§Ù„Ø´Ù…Ø§Ù„ÙŠØ©"], a: 1},
                {q: "Ù…Ù† Ø£Ù‡Ù… Ù…Ø¹Ø§Ù„Ù… Ø§Ù„Ø±ÙŠØ§Ø¶ØŸ", opts: ["Ø¨Ø±Ø¬ Ø§Ù„Ù…Ù…Ù„ÙƒØ©", "Ø¬Ø¨Ù„ Ø£Ø­Ø¯", "Ù…ÙŠÙ†Ø§Ø¡ Ø¬Ø¯Ø©"], a: 0}
            ]
        },
        { 
            name: "Ø§Ù„Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ø´Ø±Ù‚ÙŠØ©", 
            pos: {top: '32%', left: '65%'}, 
            desc: "Ø¹ØµØ¨ Ø§Ù„Ø§Ù‚ØªØµØ§Ø¯ Ø§Ù„ÙˆØ·Ù†ÙŠØŒ ØºÙ†ÙŠØ© Ø¨Ø§Ù„Ø«Ø±ÙˆØ§Øª Ø§Ù„Ù†ÙØ·ÙŠØ©.",
            qs: [
                {q: "ØªØ·Ù„ Ø§Ù„Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ø´Ø±Ù‚ÙŠØ© Ø¹Ù„Ù‰ØŸ", opts: ["Ø§Ù„Ø¨Ø­Ø± Ø§Ù„Ø£Ø­Ù…Ø±", "Ø§Ù„Ø®Ù„ÙŠØ¬ Ø§Ù„Ø¹Ø±Ø¨ÙŠ", "Ø¨Ø­Ø± Ø§Ù„Ø¹Ø±Ø¨"], a: 1},
                {q: "ØªØªÙ…ÙŠØ² Ø§Ù„Ø´Ø±Ù‚ÙŠØ© Ø¨ÙˆØ¬ÙˆØ¯ØŸ", opts: ["Ø­Ù‚ÙˆÙ„ Ø§Ù„Ù†ÙØ·", "Ø§Ù„Ø¬Ø¨Ø§Ù„ Ø§Ù„Ø´Ø§Ù‡Ù‚Ø©", "Ø§Ù„ØºØ§Ø¨Ø§Øª"], a: 0},
                {q: "Ù…Ø¯ÙŠÙ†Ø© ØµÙ†Ø§Ø¹ÙŠØ© ÙƒØ¨Ø±Ù‰ ÙÙŠ Ø§Ù„Ø´Ø±Ù‚ÙŠØ©ØŸ", opts: ["Ø§Ù„Ø¬Ø¨ÙŠÙ„", "Ø§Ù„Ø·Ø§Ø¦Ù", "Ø£Ø¨Ù‡Ø§"], a: 0}
            ]
        },
        { 
            name: "Ø§Ù„Ù…Ù†Ø·Ù‚Ø© Ø§Ù„ØºØ±Ø¨ÙŠØ©", 
            pos: {top: '42%', left: '27%'}, 
            desc: "Ù…Ù‡ÙˆÙ‰ Ø£ÙØ¦Ø¯Ø© Ø§Ù„Ù…Ø³Ù„Ù…ÙŠÙ†ØŒ ØªØ­ØªØ¶Ù† Ø§Ù„Ø­Ø±Ù…ÙŠÙ† Ø§Ù„Ø´Ø±ÙŠÙÙŠÙ†.",
            qs: [
                {q: "Ù…ÙŠÙ†Ø§Ø¡ Ø§Ù„Ù…Ù…Ù„ÙƒØ© Ø§Ù„Ø£ÙˆÙ„ ÙŠÙ‚Ø¹ ÙÙŠØŸ", opts: ["Ø¬Ø¯Ø©", "Ø§Ù„Ø¯Ù…Ø§Ù…", "Ø¬Ø§Ø²Ø§Ù†"], a: 0},
                {q: "Ø§Ù„Ù…Ø³Ø¬Ø¯ Ø§Ù„Ø­Ø±Ø§Ù… ÙŠÙ‚Ø¹ ÙÙŠØŸ", opts: ["Ù…ÙƒØ© Ø§Ù„Ù…ÙƒØ±Ù…Ø©", "Ø§Ù„Ù…Ø¯ÙŠÙ†Ø© Ø§Ù„Ù…Ù†ÙˆØ±Ø©", "Ø§Ù„Ø·Ø§Ø¦Ù"], a: 0},
                {q: "ØªØªÙ…ÙŠØ² Ø§Ù„Ø·Ø§Ø¦Ù Ø¨Ù€ØŸ", opts: ["Ø²Ø±Ø§Ø¹Ø© Ø§Ù„ÙˆØ±Ø¯", "ØµÙŠØ¯ Ø§Ù„Ø³Ù…Ùƒ", "Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ù„Ù†ÙØ·"], a: 0}
            ]
        },
        { 
            name: "Ø§Ù„Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ø´Ù…Ø§Ù„ÙŠØ©", 
            pos: {top: '15%', left: '30%'}, 
            desc: "Ø¨ÙˆØ§Ø¨Ø© ØªØ§Ø±ÙŠØ®ÙŠØ© ÙˆØ­Ø¶Ø§Ø±ÙŠØ©ØŒ ØªÙ…ØªØ§Ø² Ø¨Ø¢Ø«Ø§Ø±Ù‡Ø§ Ø§Ù„Ø¹Ø±ÙŠÙ‚Ø©.",
            qs: [
                {q: "Ù…Ù† Ø¢Ø«Ø§Ø± Ø§Ù„Ø´Ù…Ø§Ù„ Ø§Ù„Ù…Ù‡Ù…Ø©ØŸ", opts: ["Ù…Ø¯Ø§Ø¦Ù† ØµØ§Ù„Ø­", "Ù‚ØµØ± Ø§Ù„Ù…ØµÙ…Ùƒ", "Ø§Ù„Ø¯Ø±Ø¹ÙŠØ©"], a: 0},
                {q: "Ù…Ø¯ÙŠÙ†Ø© ØªØ´ØªÙ‡Ø± Ø¨Ø§Ù„Ø²ÙŠØªÙˆÙ† ÙÙŠ Ø§Ù„Ø´Ù…Ø§Ù„ØŸ", opts: ["Ø§Ù„Ø¬ÙˆÙ", "Ø­Ø§Ø¦Ù„", "ØªØ¨ÙˆÙƒ"], a: 0},
                {q: "Ù…Ø´Ø±ÙˆØ¹ Ù†ÙŠÙˆÙ… ÙŠÙ‚Ø¹ ÙÙŠØŸ", opts: ["Ø´Ù…Ø§Ù„ ØºØ±Ø¨ Ø§Ù„Ù…Ù…Ù„ÙƒØ©", "Ø¬Ù†ÙˆØ¨ Ø§Ù„Ù…Ù…Ù„ÙƒØ©", "Ø´Ø±Ù‚ Ø§Ù„Ù…Ù…Ù„ÙƒØ©"], a: 0}
            ]
        },
        { 
            name: "Ø§Ù„Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ø¬Ù†ÙˆØ¨Ø¨Ø©", 
            pos: {top: '63%', left: '40%'}, 
            desc: "Ø¬Ù…Ø§Ù„ Ø§Ù„Ø·Ø¨ÙŠØ¹Ø© ÙˆØ§Ù„Ø¬Ø¨Ø§Ù„ Ø§Ù„Ø®Ø¶Ø±Ø§Ø¡ ÙˆØ§Ù„Ù…Ø·Ø±.",
            qs: [
                {q: "Ù…Ø¯ÙŠÙ†Ø© Ø§Ù„Ø¶Ø¨Ø§Ø¨ Ù‡ÙŠØŸ", opts: ["Ø£Ø¨Ù‡Ø§", "Ø¬Ø§Ø²Ø§Ù†", "Ù†Ø¬Ø±Ø§Ù†"], a: 0},
                {q: "ØªØ´ØªÙ‡Ø± Ø¹Ø³ÙŠØ± Ø¨Ù€ØŸ", opts: ["Ø§Ù„Ù…Ø¯Ø±Ø¬Ø§Øª Ø§Ù„Ø²Ø±Ø§Ø¹ÙŠØ©", "Ø§Ù„ÙƒØ«Ø¨Ø§Ù† Ø§Ù„Ø±Ù…Ù„ÙŠØ©", "Ø§Ù„Ù…ØµØ§Ù†Ø¹"], a: 0},
                {q: "Ø¬Ø²ÙŠØ±Ø© ÙØ±Ø³Ø§Ù† ØªØªØ¨Ø¹ Ù…Ù†Ø·Ù‚Ø©ØŸ", opts: ["Ø¬Ø§Ø²Ø§Ù†", "Ø¹Ø³ÙŠØ±", "Ø§Ù„Ø¨Ø§Ø­Ø©"], a: 0}
            ]
        }
    ];

    const avatars = [
        {id: 'astronaut', icon: 'fa-user-astronaut', name: 'Ø±Ø§Ø¦Ø¯Ø© ÙØ¶Ø§Ø¡', cost: 0},
        {id: 'grad', icon: 'fa-user-graduate', name: 'Ø¹Ø§Ù„Ù…Ø©', cost: 50},
        {id: 'doc', icon: 'fa-user-doctor', name: 'Ø·Ø¨ÙŠØ¨Ø©', cost: 100},
        {id: 'eng', icon: 'fa-hard-hat', name: 'Ù…Ù‡Ù†Ø¯Ø³Ø©', cost: 150}
    ];

    /* ============ Ø­Ø§Ù„Ø© Ø§Ù„Ù„Ø¹Ø¨Ø© ============ */
    let state = {
        user: '',
        lvl: 1,
        score: 0,
        unlockedAvatars: ['astronaut'],
        currentAvatar: 'astronaut'
    };

    let tempQuiz = { regionIdx: 0, qIdx: 0, tries: 3 };

    /* ============ Ø§Ù„ØªÙ‡ÙŠØ¦Ø© ============ */
    window.onload = function() {
        const saved = JSON.parse(localStorage.getItem('saudi_game_v10'));
        if(saved) {
            state = saved;
            startGame(true);
        }
    };

    function saveState() {
        localStorage.setItem('saudi_game_v10', JSON.stringify(state));
        updateUI();
    }

    function updateUI() {
        document.getElementById('name-display').innerText = state.user;
        document.getElementById('score-display').innerText = state.score;
        document.getElementById('store-score').innerText = state.score;
        
        const avData = avatars.find(a => a.id === state.currentAvatar);
        document.getElementById('current-avatar-icon').className = `fas ${avData ? avData.icon : 'fa-user'}`;

        regions.forEach((r, i) => {
            const btn = document.getElementById(`btn-${i}`);
            btn.style.top = r.pos.top;
            btn.style.left = r.pos.left;
            btn.className = 'region-btn';
            btn.innerHTML = `<span class="region-label">${r.name}</span>`;

            if ((i + 1) < state.lvl) {
                btn.classList.add('completed');
            } else if ((i + 1) === state.lvl) {
                btn.classList.add('active');
                btn.innerHTML += '<i class="fas fa-map-marker-alt"></i>';
                const v = document.getElementById('vehicle');
                v.style.top = r.pos.top;
                v.style.left = r.pos.left;
            } else {
                btn.classList.add('locked');
                btn.innerHTML += '<i class="fas fa-lock"></i>';
            }
        });

        const pct = ((state.lvl - 1) / 5) * 100;
        document.getElementById('progress-fill').style.width = pct + '%';
        document.getElementById('progress-text').innerText = (state.lvl - 1) + '/5';
    }

    function startGame(isLoaded = false) {
        if(!isLoaded) {
            const input = document.getElementById('username').value.trim();
            if(input.length < 3) return alert("Ø§Ù„Ø±Ø¬Ø§Ø¡ ÙƒØªØ§Ø¨Ø© Ø§Ø³Ù… ØµØ­ÙŠØ­");
            state.user = input;
            saveState();
        }
        document.getElementById('login-overlay').classList.remove('active');
        document.getElementById('game-ui').style.display = 'flex';
        updateUI();
    }

    /* ============ Ù…Ù†Ø·Ù‚ Ø§Ù„Ù„Ø¹Ø¨ ============ */
    function handleClick(idx) {
        const stageNum = idx + 1;
        if(stageNum < state.lvl) return showMsg("âœ… ØªÙ… Ø¥Ù†Ø¬Ø§Ø² Ù‡Ø°Ù‡ Ø§Ù„Ù…Ù†Ø·Ù‚Ø©", "green");
        if(stageNum > state.lvl) {
            const btn = document.getElementById(`btn-${idx}`);
            btn.classList.add('shake');
            setTimeout(()=>btn.classList.remove('shake'), 500);
            playAudio('snd-wrong');
            return showMsg("ğŸ”’ Ø§Ù„Ù…Ù†Ø·Ù‚Ø© Ù…Ù‚ÙÙ„Ø©ØŒ Ø£ÙƒÙ…Ù„ÙŠ Ù…Ø§ Ù‚Ø¨Ù„Ù‡Ø§", "grey");
        }
        
        tempQuiz = { regionIdx: idx, qIdx: 0, tries: 3 };
        showQuiz();
    }

    function showQuiz() {
        const qData = regions[tempQuiz.regionIdx].qs[tempQuiz.qIdx];
        document.getElementById('quiz-title').innerText = regions[tempQuiz.regionIdx].name;
        document.getElementById('quiz-question').innerText = qData.q;
        document.getElementById('hearts').innerText = 'â¤'.repeat(tempQuiz.tries);
        document.getElementById('quiz-feedback').innerText = '';
        
        const prog = ((tempQuiz.qIdx) / 3) * 100;
        document.getElementById('quiz-progress-fill').style.width = prog + '%';

        const optsDiv = document.getElementById('quiz-options');
        optsDiv.innerHTML = '';
        qData.opts.forEach((opt, i) => {
            const btn = document.createElement('button');
            btn.className = 'btn btn-option';
            btn.innerText = opt;
            btn.onclick = () => checkAnswer(i, btn);
            optsDiv.appendChild(btn);
        });
        
        document.getElementById('quiz-overlay').classList.add('active');
    }

    function checkAnswer(ansIdx, btn) {
        const correct = regions[tempQuiz.regionIdx].qs[tempQuiz.qIdx].a;
        document.querySelectorAll('.btn-option').forEach(b => b.disabled = true);

        if(ansIdx === correct) {
            btn.classList.add('correct');
            state.score += 10;
            saveState();
            
            setTimeout(() => {
                if(tempQuiz.qIdx < 2) {
                    tempQuiz.qIdx++;
                    showQuiz();
                } else {
                    document.getElementById('quiz-overlay').classList.remove('active');
                    showInfo();
                }
            }, 1000);
        } else {
            btn.classList.add('wrong');
            playAudio('snd-wrong');
            tempQuiz.tries--;
            document.getElementById('hearts').innerText = 'â¤'.repeat(tempQuiz.tries);
            if(tempQuiz.tries === 0) {
                alert("Ø§Ù†ØªÙ‡Øª Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø§Øª! Ø­Ø§ÙˆÙ„ÙŠ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰.");
                document.getElementById('quiz-overlay').classList.remove('active');
            } else {
                setTimeout(() => {
                     document.querySelectorAll('.btn-option').forEach(b => b.disabled = false);
                }, 1000);
            }
        }
    }

    function showInfo() {
        const r = regions[tempQuiz.regionIdx];
        document.getElementById('info-title').innerText = `Ø£Ø­Ø³Ù†ØªÙ! Ø£Ù†Ù‡ÙŠØªÙ ${r.name}`;
        document.getElementById('info-desc').innerText = r.desc;
        document.getElementById('info-overlay').classList.add('active');
        playAudio('snd-correct');
    }

    function closeInfoAndProceed() {
        document.getElementById('info-overlay').classList.remove('active');
        
        if((tempQuiz.regionIdx + 1) === state.lvl) {
            state.lvl++;
            saveState();
        }

        if(state.lvl > 5) {
            setTimeout(() => {
                document.getElementById('winner-name').innerText = state.user;
                document.getElementById('win-overlay').classList.add('active');
                playAudio('snd-win');
            }, 2000);
        }
    }

    /* ============ Ø§Ù„Ù…ØªØ¬Ø± ============ */
    function openStore() {
        const grid = document.getElementById('store-grid');
        grid.innerHTML = '';
        
        avatars.forEach(av => {
            const isUnlocked = state.unlockedAvatars.includes(av.id);
            const isSelected = state.currentAvatar === av.id;
            
            const div = document.createElement('div');
            div.className = `store-item ${isUnlocked ? 'unlocked' : ''} ${isSelected ? 'selected' : ''}`;
            
            div.innerHTML = `
                <i class="fas ${av.icon} avatar-icon"></i>
                <div style="font-weight:bold;">${av.name}</div>
                ${!isUnlocked ? `<div class="price-tag">${av.cost} ğŸª™</div>` : ''}
                <button class="btn-buy" onclick="buyAvatar('${av.id}')" ${!isUnlocked && state.score < av.cost ? 'disabled' : ''}>
                    ${isSelected ? 'Ù…Ø³ØªØ®Ø¯Ù…' : (isUnlocked ? 'Ø§Ø®ØªØ±' : 'Ø´Ø±Ø§Ø¡')}
                </button>
            `;
            grid.appendChild(div);
        });
        
        document.getElementById('store-overlay').classList.add('active');
    }

    function buyAvatar(id) {
        const av = avatars.find(a => a.id === id);
        
        if(state.unlockedAvatars.includes(id)) {
            state.currentAvatar = id;
        } else {
            if(state.score >= av.cost) {
                state.score -= av.cost;
                state.unlockedAvatars.push(id);
                state.currentAvatar = id;
                playAudio('snd-correct');
            } else {
                return alert("Ù„Ø§ ØªÙ…Ù„Ùƒ Ù†Ù‚Ø§Ø·Ø§Ù‹ ÙƒØ§ÙÙŠØ©!");
            }
        }
        saveState();
        openStore();
    }

    /* ============ Ø§Ù„Ø·Ø¨Ø§Ø¹Ø© ÙˆØ§Ù„Ø´Ù‡Ø§Ø¯Ø© ============ */
    function printCertificate() {
        document.getElementById('cert-name-display').innerText = state.user;
        const d = new Date();
        document.getElementById('cert-date-display').innerText = `${d.getFullYear()}/${d.getMonth()+1}/${d.getDate()}`;
        window.print();
    }

    /* ============ Ø£Ø¯ÙˆØ§Øª ============ */
    function showMsg(txt, color) {
        const m = document.getElementById('msg-box');
        m.innerText = txt; m.style.color = color;
        setTimeout(() => m.innerText = '', 2000);
    }
    
    function playAudio(id) {
        const a = document.getElementById(id);
        if(a) { a.currentTime = 0; a.play().catch(e => console.log(e)); }
    }

    function resetGame() {
        if(confirm("Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø§Ù„Ø®Ø±ÙˆØ¬ ÙˆØ­Ø°Ù Ø§Ù„ØªÙ‚Ø¯Ù…ØŸ")) {
            localStorage.removeItem('saudi_game_v10');
            location.reload();
        }
    }
</script>

</body>
</html>
